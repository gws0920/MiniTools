var O=Object.defineProperty;var Y=(s,e,t)=>e in s?O(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>(Y(s,typeof e!="symbol"?e+"":e,t),t),x=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var c=(s,e,t)=>(x(s,e,"read from private field"),t?t.call(s):e.get(s)),h=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},g=(s,e,t,r)=>(x(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t);class B{constructor(e){o(this,"TValue");o(this,"TOmitInitKey");o(this,"options");this.options=e}}class d{constructor(e,t,r,n){o(this,"definition");o(this,"options");o(this,"struct");o(this,"value");this.definition=e,this.options=t,this.struct=r,this.value=n}get hasCustomAccessors(){return this.get!==d.prototype.get||this.set!==d.prototype.set}getSize(){return this.definition.getSize()}get(){return this.value}set(e){this.value=e}}const l={reject(s){return new j(s)},resolve(s){return typeof s=="object"&&s!==null&&typeof s.then=="function"?s instanceof U||s instanceof R||s instanceof j?s:new U(s):new R(s)},try(s){try{return l.resolve(s())}catch(e){return l.reject(e)}}};var f;const S=class S{constructor(e){h(this,f,void 0);g(this,f,e)}then(e,t){return new S(c(this,f).then(e,t))}valueOrPromise(){return c(this,f)}};f=new WeakMap;let U=S;var v;class R{constructor(e){h(this,v,void 0);g(this,v,e)}then(e){return e?l.try(()=>e(c(this,v))):this}valueOrPromise(){return c(this,v)}}v=new WeakMap;var z;class j{constructor(e){h(this,z,void 0);g(this,z,e)}then(e,t){return t?l.try(()=>t(c(this,z))):this}valueOrPromise(){throw c(this,z)}}z=new WeakMap;function _(s,e,t){const r=+!!t,n=+!t;return BigInt(s.getInt32(e,t)*n+s.getInt32(e+4,t)*r)<<32n|BigInt(s.getUint32(e,t)*r+s.getUint32(e+4,t)*n)}function G(s,e,t){const r=s.getUint32(e,t),n=s.getUint32(e+4,t),i=+!!t,a=+!t;return BigInt(r*a+n*i)<<32n|BigInt(r*i+n*a)}function K(s,e,t,r){const n=Number(t>>32n),i=Number(BigInt.asUintN(32,t));r?(s.setInt32(e+4,n,r),s.setUint32(e,i,r)):(s.setInt32(e,n,r),s.setUint32(e+4,i,r))}function H(s,e,t,r){const n=Number(t>>32n),i=Number(BigInt.asUintN(32,t));r?(s.setUint32(e+4,n,r),s.setUint32(e,i,r)):(s.setUint32(e,n,r),s.setUint32(e+4,i,r))}const J="getBigInt64"in DataView.prototype?(s,e,t)=>s.getBigInt64(e,t):_,Q="getBigUint64"in DataView.prototype?(s,e,t)=>s.getBigUint64(e,t):G,X="setBigInt64"in DataView.prototype?(s,e,t,r)=>s.setBigInt64(e,t,r):K,Z="setBigUint64"in DataView.prototype?(s,e,t,r)=>s.setBigUint64(e,t,r):H,p=class p{constructor(e,t,r){o(this,"TTypeScriptType");o(this,"size");o(this,"getter");o(this,"setter");this.size=e,this.getter=t,this.setter=r}};o(p,"Int64",new p(8,J,X)),o(p,"Uint64",new p(8,Q,Z));let P=p;class ue extends B{constructor(t,r){super();o(this,"type");this.type=t}getSize(){return this.type.size}create(t,r,n){return new E(this,t,r,n)}deserialize(t,r,n){return l.try(()=>r.readExactly(this.getSize())).then(i=>{const a=new DataView(i.buffer,i.byteOffset,i.byteLength),y=this.type.getter(a,0,t.littleEndian);return this.create(t,n,y)}).valueOrPromise()}}class E extends d{serialize(e,t){this.definition.type.setter(e,t,this.value,this.options.littleEndian)}}function le(){}const{TextEncoder:V,TextDecoder:k}=globalThis,F=new V,ee=new k;function te(s){return F.encode(s)}function se(s){return ee.decode(s)}class W{constructor(){o(this,"TTypeScriptType")}}const w=class w extends W{constructor(){super()}toBuffer(e){return e}toValue(e){return e}getSize(e){return e.byteLength}};o(w,"Instance",new w);let C=w;const b=class b extends W{toBuffer(e){return te(e)}toValue(e){return se(e)}getSize(){return-1}};o(b,"Instance",new b);let D=b;const re=new Uint8Array(0);class he extends B{constructor(t,r){super(r);o(this,"type");this.type=t}getDeserializeSize(t){return this.getSize()}create(t,r,n,i){return new ne(this,t,r,n,i)}deserialize(t,r,n){return l.try(()=>{const i=this.getDeserializeSize(n);return i===0?re:r.readExactly(i)}).then(i=>{const a=this.type.toValue(i);return this.create(t,n,a,i)}).valueOrPromise()}}class ne extends d{constructor(t,r,n,i,a){super(t,r,n,i);o(this,"array");this.array=a}set(t){super.set(t),this.array=void 0}serialize(t,r){this.array||(this.array=this.definition.type.toBuffer(this.value)),new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(this.array,r)}}var M;(function(s){s.Uint8={signed:!1,size:1,deserialize(e){return e[0]},serialize(e,t,r){e.setUint8(t,r)}},s.Int8={signed:!0,size:1,deserialize(e){return s.Uint8.deserialize(e,!1)<<24>>24},serialize(e,t,r){e.setInt8(t,r)}},s.Uint16={signed:!1,size:2,deserialize(e,t){const r=e[1]<<8|e[0],n=e[0]<<8|e[1];return t?r:n},serialize(e,t,r,n){e.setUint16(t,r,n)}},s.Int16={signed:!0,size:2,deserialize(e,t){return s.Uint16.deserialize(e,t)<<16>>16},serialize(e,t,r,n){e.setInt16(t,r,n)}},s.Uint32={signed:!1,size:4,deserialize(e,t){return s.Int32.deserialize(e,t)>>>0},serialize(e,t,r,n){e.setUint32(t,r,n)}},s.Int32={signed:!0,size:4,deserialize(e,t){const r=e[3]<<24|e[2]<<16|e[1]<<8|e[0],n=e[0]<<24|e[1]<<16|e[2]<<8|e[3];return t?r:n},serialize(e,t,r,n){e.setInt32(t,r,n)}}})(M||(M={}));class ge extends B{constructor(t,r){super();o(this,"type");this.type=t}getSize(){return this.type.size}create(t,r,n){return new ie(this,t,r,n)}deserialize(t,r,n){return l.try(()=>r.readExactly(this.getSize())).then(i=>{const a=this.type.deserialize(i,t.littleEndian);return this.create(t,n,a)}).valueOrPromise()}}class ie extends d{serialize(e,t){this.definition.type.serialize(e,t,this.value,this.options.littleEndian)}}var N=function(){function s(){var e=this;this._state="running",this.resolve=function(t){e._resolve(t),e._state="resolved"},this.reject=function(t){e._reject(t),e._state="rejected"},this._promise=new Promise(function(t,r){e._resolve=t,e._reject=r})}return Object.defineProperty(s.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),s}(),pe=function(){function s(e){e===void 0&&(e=0),this.pendingResolvers=new Map,this.nextId=e}return s.prototype.add=function(){var e=this.nextId++,t=new N;return this.pendingResolvers.set(e,t),[e,t.promise]},s.prototype.getResolver=function(e){if(!this.pendingResolvers.has(e))return null;var t=this.pendingResolvers.get(e);return this.pendingResolvers.delete(e),t},s.prototype.resolve=function(e,t){var r=this.getResolver(e);return r!==null?(r.resolve(t),!0):!1},s.prototype.reject=function(e,t){var r=this.getResolver(e);return r!==null?(r.reject(t),!0):!1},s}();const I=globalThis,fe=I.AbortController,ve=I.ReadableStream,oe=I.WritableStream,L=I.TransformStream,{console:T}=globalThis;var A;const ce=((A=T.createTask)==null?void 0:A.bind(T))??(()=>({run(s){return s()}}));var m,u;class ${constructor(e){h(this,m,void 0);h(this,u,void 0);o(this,"value");o(this,"consumed");g(this,m,ce("Consumable")),this.value=e,g(this,u,new N),this.consumed=c(this,u).promise}consume(){c(this,u).resolve()}error(e){c(this,u).reject(e)}async tryConsume(e){try{const t=await c(this,m).run(()=>e(this.value));return c(this,u).resolve(),t}catch(t){throw c(this,u).reject(t),t}}}m=new WeakMap,u=new WeakMap;async function q(s,e){const t=new $(e);s.enqueue(t),await t.consumed}class ze extends L{constructor(){super({async transform(e,t){await q(t,e)}})}}class de extends oe{static async write(e,t){const r=new $(t);await e.write(r),await r.consumed}constructor(e,t){let r;t&&(r={},"highWaterMark"in t&&(r.highWaterMark=t.highWaterMark),"size"in t&&(r.size=n=>t.size(n.value))),super({start(n){var i;return(i=e.start)==null?void 0:i.call(e,n)},async write(n,i){await n.tryConsume(a=>{var y;return(y=e.write)==null?void 0:y.call(e,a,i)})},abort(n){var i;return(i=e.abort)==null?void 0:i.call(e,n)},close(){var n;return(n=e.close)==null?void 0:n.call(e)}},r)}}class me extends L{constructor(e){let t;super({async start(r){var n;t={async enqueue(i){await q(r,i)},close(){r.terminate()},error(i){r.error(i)}},await((n=e.start)==null?void 0:n.call(e,t))},async transform(r){await r.tryConsume(n=>{var i;return(i=e.transform)==null?void 0:i.call(e,n,t)}),r.consume()},async flush(){var r;await((r=e.flush)==null?void 0:r.call(e,t))}})}}export{fe as A,he as B,me as C,re as E,ge as N,N as P,ve as R,d as S,L as T,C as U,oe as W,ne as a,M as b,ue as c,P as d,D as e,l as f,se as g,de as h,te as i,Q as j,pe as k,ze as l,le as p,Z as s};
